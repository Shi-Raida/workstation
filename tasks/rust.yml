---
- vars:
    rustup_file: "{{ ansible_user_dir }}/.cargo/bin/rustup"
  block:
    - name: Install curl from apt
      ansible.builtin.apt:
        name: curl
      become: true

    - name: Install rust toolchain
      ansible.builtin.shell:
        cmd: curl https://sh.rustup.rs | sh -s -- --no-modify-path -y
        creates: "{{ rustup_file }}"

    - name: Update rust toolchain
      ansible.builtin.command: "{{ rustup_file }} update"
      register: rustup_update
      changed_when: "'updated' in rustup_update.stdout"
